# TTS Reader 综合优化方案 (v0.3.0 优化规划)

基于对当前版本软件在“截图朗读延迟”、“设置面貌老旧”以及“安装包体积臃肿”三个痛点的分析，现出具一份适合下阶段版本（如 `v0.3.0`）综合落地的优化方案。

该方案将从“用户体验”、“界面现代化”和“轻量化”三个核心维度展开，并提供研发可直接执行的建议。

---

## 阶段一：核心架构重构（解决延迟与体积问题，优先级最高）（✅ 已完成）

当前软件最大的弊端是使用 `rapidocr-onnxruntime`（外挂的庞大 AI 模型）与 Windows 原生重度截图工具（`ms-screenclip`）。这同时导致了 **3秒高延迟** 和 **近百兆的臃肿体积**。

### 1. OCR 引擎替换为 Windows 原生 API（体积 -50MB，延迟 -500ms）
- **痛点**：`rapidocr` 带来庞大的模型体积、Numpy 科学计算库依赖，且纯 CPU 推理导致耗时近 1 秒。
- **优化方案**：废弃 `rapidocr`，引入轻量级的 `winsdk`。直接调用 Windows 10/11 底层自带的异步 `Windows.Media.Ocr` 接口。
- **收益**：体积暴减，OCR 解析时间从约 1 秒直接逼近瞬间完成。

### 2. 弃用原生截图，自研内存截取蒙层（延迟 -1000ms）
- **痛点**：调用系统截图并监控剪贴板，过程漫长，且会覆盖用户自己的剪贴板记录。
- **优化方案**：程序内部用 Tkinter 实现一个透明的“全屏置灰遮罩层”，让用户鼠标通过拖拽产生选区。鼠标松开的一瞬间，坐标直接传给内存中的原始背景图片进行裁切，并直接喂给上述的 `Windows.Media.Ocr`。
- **收益**：彻底消除截图软件调度和剪贴板读写的几十上百毫秒的物理损耗。实现真正的“即选即读”。

### 3. 加入“微交互”补偿体感（防发愣）
- 如果文字极多导致语音系统初次缓冲缓慢，在用户松开鼠标那一刻，立刻发出短促悦耳的“叮”声，打消用户的“程序没反应”焦虑。

---

## 阶段二：控制面板 UI 现代化（改善应用第一印象，操作更顺手）（✅ 已完成）

现有的 `tkinter` 虽然保证了无需庞然大物（如 Electron）的基础运行，但原生的样式完全不符合 Win11 时代审美。

### 1. 零成本换皮方案：引入 `sv_ttk`
- 仅需 `pip install sv-ttk`，并在 `control_panel.py` 的主循环前加两行代码，就能让这个像上世纪产物的设置界面直接蜕变为支持“深/浅色模式自适应”的 Windows 11 Fluent 风格。无需重写任何控件逻辑。

### 2. 信息架构与排版优化
研发应在现有网格排版上做以下改造（这并不需要更换底层的 Tkinter）：
- **功能卡片化**：给关联性强的设置项加上 GroupBox 边框，划分为三大块：
  - 【热键配置】（文本朗读、截图朗读）
  - 【容错与延时管理】（剪贴板重试、最大字符数限制）
  - 【发音引擎】（语速、指定音色、空文本是否报错提示）
- **直观的保存机制**：将零散的 `Reload` 和 `Save & Apply` 按钮，固定放置在一个永远处于窗口最下方右下角的悬浮面板内。
- **友好的文案展示**：把英文变量名直接映射的晦涩标签，统一修改为易懂的中文注释（如 `Text Hotkey` 改为 `选中文本朗读快捷键`）。

---

## 阶段三：极致打包与发布优化（物理终极瘦身）（✅ 已完成）

在核心架构替换完毕（已砍掉最大的 AI 库）后，最后在生成的环节进行极限压榨。

### 1. 严格的纯净环境构建
- CI/CD（GitHub Actions）或本地开发者在运行 PyInstaller 前，必须创建纯净的虚拟环境，仅安装 `requirements.txt` 及 `winsdk`，避免测试工具如 `pytest` 被混入。

### 2. `PyInstaller` Specs 排除无用模块
- 在打包说明文件（`.spec`）中，主动对不会使用的庞大 Python 标准内置模块进行剔除，如：
  `excludes=['email', 'xml', 'html', 'http', 'unittest', 'urllib']`。

### 3. 应用 UPX 压缩指令
- 要求运行打包命令的环境内预埋 [UPX](https://upx.github.io/) 执行文件。虽然目前的 `spec` 里写着 `upx=True`，但大部分开发者电脑上没装这个库导致其未生效。
- UPX 可将最终产物的体积进一步做可执行文件级别的物理压缩。

---

## 【总结与预期收益】

如果本次综合优化全部落地，你可以得到一个怎样的软件？

- **性能体验**：截图后不需要再忍受 3 秒折磨。体验将从“等几秒才说话”变成**“鼠标松开的瞬间，声音就跟着出来”**。
- **视觉体验**：告别灰色老式方块界面。设置面板变成一个暗黑护眼、边缘柔和的 Win11 风格现代工具。
- **交付体验**：一个体积从 100MB 暴跌到可能**不到 20MB**的纯绿色单文件 `.exe`。解压即用，不再造成任何硬盘焦虑。
